const _0x10fdbb=_0x5706;(function(_0x4a9d6b,_0x5978fc){const _0x52fde6=_0x5706,_0x5388e4=_0x4a9d6b();while(!![]){try{const _0x33ad32=-parseInt(_0x52fde6(0x172))/0x1*(-parseInt(_0x52fde6(0x1e7))/0x2)+-parseInt(_0x52fde6(0x1a6))/0x3*(parseInt(_0x52fde6(0x1cc))/0x4)+-parseInt(_0x52fde6(0x201))/0x5+-parseInt(_0x52fde6(0x1f9))/0x6+parseInt(_0x52fde6(0x14e))/0x7+parseInt(_0x52fde6(0x152))/0x8+-parseInt(_0x52fde6(0x1cb))/0x9*(-parseInt(_0x52fde6(0x194))/0xa);if(_0x33ad32===_0x5978fc)break;else _0x5388e4['push'](_0x5388e4['shift']());}catch(_0x44d98d){_0x5388e4['push'](_0x5388e4['shift']());}}}(_0x46e3,0xe1097));const net=require(_0x10fdbb(0x184)),http=require(_0x10fdbb(0x1c0)),{Buffer}=require('buffer'),{exec,execSync}=require(_0x10fdbb(0x17f)),UUID=process[_0x10fdbb(0x154)][_0x10fdbb(0x1fa)]||_0x10fdbb(0x1aa),NEZHA_SERVER=process[_0x10fdbb(0x154)][_0x10fdbb(0x1eb)]||'',NEZHA_PORT=process[_0x10fdbb(0x154)]['NEZHA_PORT']||'',NEZHA_KEY=process['env'][_0x10fdbb(0x177)]||'',SUB_PATH=process[_0x10fdbb(0x154)]['SUB_PATH']||_0x10fdbb(0x19e),XPATH=process[_0x10fdbb(0x154)][_0x10fdbb(0x1b6)]||UUID[_0x10fdbb(0x1f8)](0x0,0x8),DOMAIN=process[_0x10fdbb(0x154)][_0x10fdbb(0x1f6)]||'kijiazhz-kejiland.hf.space',NAME=process[_0x10fdbb(0x154)]['NAME']||'Hf',PORT=process[_0x10fdbb(0x154)]['PORT']||0x1eb4,SETTINGS={[_0x10fdbb(0x1fa)]:UUID,[_0x10fdbb(0x17d)]:_0x10fdbb(0x1b3),['BUFFER_SIZE']:_0x10fdbb(0x17e),[_0x10fdbb(0x1b6)]:_0x10fdbb(0x166)+XPATH,[_0x10fdbb(0x14c)]:0x1e,['MAX_POST_SIZE']:0xf4240,[_0x10fdbb(0x1ff)]:0x7530,[_0x10fdbb(0x199)]:0x400*0x400,[_0x10fdbb(0x1dd)]:!![],[_0x10fdbb(0x16c)]:!![]};function validate_uuid(_0x298167,_0x1ab629){for(let _0x1441e7=0x0;_0x1441e7<0x10;_0x1441e7++){if(_0x298167[_0x1441e7]!==_0x1ab629[_0x1441e7])return![];}return!![];}function concat_typed_arrays(_0x17faf6,..._0x193e6c){const _0x8a1ebd=_0x10fdbb;if(!_0x193e6c||_0x193e6c[_0x8a1ebd(0x178)]<0x1)return _0x17faf6;let _0x432045=_0x17faf6[_0x8a1ebd(0x178)];for(let _0x3e4298 of _0x193e6c)_0x432045+=_0x3e4298['length'];const _0x486591=new _0x17faf6[(_0x8a1ebd(0x1b8))](_0x432045);_0x486591['set'](_0x17faf6,0x0),_0x432045=_0x17faf6[_0x8a1ebd(0x178)];for(let _0x3d2a15 of _0x193e6c){_0x486591['set'](_0x3d2a15,_0x432045),_0x432045+=_0x3d2a15[_0x8a1ebd(0x178)];}return _0x486591;}function log(_0x47b637,..._0x3e426a){const _0x59c7ca=_0x10fdbb;if(SETTINGS[_0x59c7ca(0x17d)]==='none')return;const _0x2abe9f={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x3b292b={'debug':_0x59c7ca(0x195),'info':_0x59c7ca(0x1e3),'warn':'\x1b[33m','error':'\x1b[31m','reset':'\x1b[0m'},_0x41d90b=_0x2abe9f[SETTINGS[_0x59c7ca(0x17d)]]||0x1,_0x2d3dac=_0x2abe9f[_0x47b637]||0x0;if(_0x2d3dac>=_0x41d90b){const _0xab78aa=new Date()[_0x59c7ca(0x1a5)](),_0x1f465b=_0x3b292b[_0x47b637]||_0x3b292b[_0x59c7ca(0x187)];console[_0x59c7ca(0x1e1)](_0x1f465b+'['+_0xab78aa+']\x20['+_0x47b637+']',..._0x3e426a,_0x3b292b[_0x59c7ca(0x187)]);}}const runnz=async()=>{const _0x5676b9=_0x10fdbb;let _0x478f2b='',_0x4308d3='';const _0x10522f=[_0x5676b9(0x1c3),_0x5676b9(0x15d),_0x5676b9(0x149),'2087',_0x5676b9(0x18e),_0x5676b9(0x1d1)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY)_0x478f2b=_0x10522f[_0x5676b9(0x163)](NEZHA_PORT)?_0x5676b9(0x1a1):'',_0x4308d3='nohup\x20./npm\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+_0x5676b9(0x155)+NEZHA_KEY+'\x20'+_0x478f2b+_0x5676b9(0x153);else return;try{exec(_0x4308d3,{'shell':'/bin/bash'}),console[_0x5676b9(0x1e1)](_0x5676b9(0x1e4));}catch(_0x29d1a1){}};function parse_uuid(_0x471843){const _0x199e51=_0x10fdbb;_0x471843=_0x471843['replaceAll']('-','');const _0x2b4573=[];for(let _0x15d9b1=0x0;_0x15d9b1<0x10;_0x15d9b1++){_0x2b4573[_0x199e51(0x161)](parseInt(_0x471843['substr'](_0x15d9b1*0x2,0x2),0x10));}return _0x2b4573;}async function read_vless_header(_0x304857,_0x24f34c){const _0x1dffcb=_0x10fdbb;let _0x3b41c8=0x0,_0xb99143=new Uint8Array(),_0x734294={'value':_0xb99143,'done':![]};async function _0x513266(_0x5e7ae6){const _0x8723a4=_0x5706;if(_0x734294[_0x8723a4(0x1f3)])throw new Error('header\x20length\x20too\x20short');const _0x5b352f=_0x5e7ae6-_0x3b41c8;if(_0x5b352f<0x1)return;_0x734294=await read_atleast(_0x304857,_0x5b352f),_0x3b41c8+=_0x734294[_0x8723a4(0x1af)]['length'],_0xb99143=concat_typed_arrays(_0xb99143,_0x734294['value']);}await _0x513266(0x1+0x10+0x1);const _0x5d3fde=_0xb99143[0x0],_0xc8c89a=_0xb99143[_0x1dffcb(0x1f8)](0x1,0x1+0x10),_0x41d829=parse_uuid(_0x24f34c);if(!validate_uuid(_0xc8c89a,_0x41d829))throw new Error(_0x1dffcb(0x188));const _0x5a3d63=_0xb99143[0x1+0x10],_0x4acf71=0x1+0x10+0x1+_0x5a3d63+0x1+0x2+0x1;await _0x513266(_0x4acf71+0x1);const _0x3c3dda=_0xb99143[0x1+0x10+0x1+_0x5a3d63],_0x34223a=0x1;if(_0x3c3dda!==_0x34223a)throw new Error('unsupported\x20command:\x20'+_0x3c3dda);const _0x2be491=(_0xb99143[_0x4acf71-0x1-0x2]<<0x8)+_0xb99143[_0x4acf71-0x1-0x1],_0x390e87=_0xb99143[_0x4acf71-0x1],_0x569169=0x1,_0x223149=0x2,_0x5b59f9=0x3;let _0x547246=-0x1;if(_0x390e87===_0x569169)_0x547246=_0x4acf71+0x4;else{if(_0x390e87===_0x5b59f9)_0x547246=_0x4acf71+0x10;else _0x390e87===_0x223149&&(_0x547246=_0x4acf71+0x1+_0xb99143[_0x4acf71]);}if(_0x547246<0x0)throw new Error('read\x20address\x20type\x20failed');await _0x513266(_0x547246);const _0x4040b5=_0x4acf71;let _0x1a90e9='';if(_0x390e87===_0x569169)_0x1a90e9=_0xb99143[_0x1dffcb(0x1f8)](_0x4040b5,_0x4040b5+0x4)[_0x1dffcb(0x19d)]('.');else{if(_0x390e87===_0x223149)_0x1a90e9=new TextDecoder()[_0x1dffcb(0x1fc)](_0xb99143[_0x1dffcb(0x1f8)](_0x4040b5+0x1,_0x4040b5+0x1+_0xb99143[_0x4040b5]));else _0x390e87===_0x5b59f9&&(_0x1a90e9=_0xb99143[_0x1dffcb(0x1f8)](_0x4040b5,_0x4040b5+0x10)[_0x1dffcb(0x173)]((_0x4e9a9b,_0x1fe2e0,_0x250142,_0x418c05)=>_0x250142%0x2?_0x4e9a9b[_0x1dffcb(0x175)](((_0x418c05[_0x250142-0x1]<<0x8)+_0x1fe2e0)['toString'](0x10)):_0x4e9a9b,[])[_0x1dffcb(0x19d)](':'));}if(!_0x1a90e9){log(_0x1dffcb(0x1a8),'Failed\x20to\x20parse\x20hostname');throw new Error(_0x1dffcb(0x1e2));}return log(_0x1dffcb(0x1c5),_0x1dffcb(0x1d0)+_0x1a90e9+':'+_0x2be491),{'hostname':_0x1a90e9,'port':_0x2be491,'data':_0xb99143['slice'](_0x547246),'resp':new Uint8Array([_0x5d3fde,0x0])};}async function read_atleast(_0x8f92a6,_0x558e4f){const _0x20e0a=_0x10fdbb,_0x505f32=[];let _0x543e3c=![];while(_0x558e4f>0x0&&!_0x543e3c){const _0x3f1ca4=await _0x8f92a6['read']();if(_0x3f1ca4[_0x20e0a(0x1af)]){const _0x53d2fc=new Uint8Array(_0x3f1ca4[_0x20e0a(0x1af)]);_0x505f32['push'](_0x53d2fc),_0x558e4f-=_0x53d2fc['length'];}_0x543e3c=_0x3f1ca4[_0x20e0a(0x1f3)];}if(_0x558e4f>0x0)throw new Error(_0x20e0a(0x1df));return{'value':concat_typed_arrays(..._0x505f32),'done':_0x543e3c};}function _0x5706(_0x263d22,_0x51eefd){const _0x46e378=_0x46e3();return _0x5706=function(_0x57067d,_0xaee0c8){_0x57067d=_0x57067d-0x144;let _0x23732c=_0x46e378[_0x57067d];return _0x23732c;},_0x5706(_0x263d22,_0x51eefd);}async function parse_header(_0x29b5d1,_0xd677da){const _0x2b3097=_0x10fdbb;log(_0x2b3097(0x1c2),_0x2b3097(0x192));const _0x26e3dc=_0xd677da[_0x2b3097(0x1d9)][_0x2b3097(0x168)]();try{const _0x2543fe=await read_vless_header(_0x26e3dc,_0x29b5d1);return log(_0x2b3097(0x1c2),_0x2b3097(0x18a)),_0x2543fe;}catch(_0x910461){log(_0x2b3097(0x1a8),'VLESS\x20header\x20parse\x20error:\x20'+_0x910461[_0x2b3097(0x16d)]);throw new Error(_0x2b3097(0x1d6)+_0x910461[_0x2b3097(0x16d)]);}finally{_0x26e3dc[_0x2b3097(0x1b7)]();}}async function connect_remote(_0x502d6d,_0x874bff){const _0x136302=_0x10fdbb,_0x34581d=0x1f40;try{const _0x53e67a=await timed_connect(_0x502d6d,_0x874bff,_0x34581d);return _0x53e67a[_0x136302(0x1c7)](!![]),_0x53e67a[_0x136302(0x186)](!![],0x3e8),_0x53e67a[_0x136302(0x15e)]=parseInt(SETTINGS['BUFFER_SIZE'])*0x400,log('info','Connected\x20to\x20'+_0x502d6d+':'+_0x874bff),_0x53e67a;}catch(_0x4cfae9){log(_0x136302(0x1a8),_0x136302(0x1ca)+_0x4cfae9[_0x136302(0x16d)]);throw _0x4cfae9;}}function _0x46e3(){const _0x590edb=['3196112SCjGqQ','finally','Relay\x20error:','port','VLESS\x20connection\x20to\x20','2053','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','Created\x20new\x20session\x20with\x20UUID:\x20','Remote\x20connection\x20not\x20available','\x20before\x20initialization','read\x20vless\x20header\x20error:\x20','delete','chunked','readable','socket\x20hang\x20up','set','Failed\x20to\x20get\x20IP\x20address:','TCP_NODELAY','initialized','not\x20enough\x20data\x20to\x20read','enqueue','log','parse\x20hostname\x20failed','\x1b[32m','App\x20is\x20running','reading_done','no-store','28BSvUpr','headersTimeout','size','remote','NEZHA_SERVER','aborted','write','downstreamStarted','Socket\x20is\x20destroyed','Socket\x20error:','vlessHeader','toString','done','fill','localhost','DOMAIN','Remote\x20error:\x20','slice','9332694KfylBs','UUID','Failed\x20to\x20process\x20POST\x20request:\x20','decode','timeout','stream','SESSION_TIMEOUT','pipe','1849880BdVDac','connect\x20timeout','\x20bytes','alpnProtocol','Read\x20controller\x20error:','GET,\x20POST','cleanup','url','Failed\x20to\x20initialize\x20VLESS\x20connection','has','2096','end','\x20timed\x20out\x20without\x20downstream','MAX_BUFFERED_POSTS','Hello,\x20World\x0a','3467436yrIRNm','/([^/]+)(?:/([0-9]+))?$','Failed\x20to\x20write\x20to\x20remote:\x20','catch','10396152TVeZRg','\x20>/dev/null\x202>&1\x20&','env','\x20-p\x20','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','socket','Buffered\x20packet\x20seq=','keepAliveTimeout','from','writeHead','hostname','8443','bufferSize','processPacket','responseHeader','push','Created\x20new\x20session\x20for\x20POST:\x20','includes','listen',',\x20size=','%2F','&fp=chrome&allowInsecure=1&type=xhttp&host=','getReader','headerSent','writable','Transfer-Encoding','TCP_KEEPALIVE','message','nextTick','vless://','get','trim','111513ROcDEL','reduce','GET','concat','close','NEZHA_KEY','length','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','Error\x20starting\x20downstream:\x20','&path=','headersSent','LOG_LEVEL','1024','child_process','Process\x20packet\x20error:\x20','writableEnded','random','utf-8','net','text/plain','setKeepAlive','reset','invalid\x20UUID','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','VLESS\x20header\x20parsed\x20successfully','lastActivity','destroy','Too\x20many\x20buffered\x20packets','2083','_writeToRemote','VLESS\x20header\x20parsed:\x20','POST','Starting\x20to\x20parse\x20VLESS\x20header','pendingPackets','2901550LRjsvf','\x1b[36m','uncork','Client\x20connection\x20closed','currentStreamRes','CHUNK_SIZE','Failed\x20to\x20initialize\x20VLESS:\x20','createServer','cleaned','join','sub','getWriter','Session\x20','--tls','&mode=packet-up#','Sending\x20VLESS\x20response\x20header\x20(','application/octet-stream','toISOString','3RiOyvZ','match','error','base64','39e1d0c4-a422-4d35-a128-8cedc062d1fe','data','resume','MAX_POST_SIZE','pendingBuffers','value','Download\x20error:\x20','Upload\x20error:\x20','warn','none','http/1.1','destroyed','XPATH','releaseLock','constructor','New\x20secure\x20connection\x20using:\x20','Server\x20error:\x20','nextSeq','pause','pipeTo','resp','bufferedData','http','Processed\x20packet\x20seq=','debug','443','uuid','info','startDownstream','setNoDelay','initializeVLESS','createConnection','Connection\x20failed:\x20','9RHwnpf'];_0x46e3=function(){return _0x590edb;};return _0x46e3();}function timed_connect(_0x4b9624,_0xe1c834,_0xf72b81){return new Promise((_0x46a0cf,_0x5b4bbb)=>{const _0x25fdd6=_0x5706,_0x4b941c=net[_0x25fdd6(0x1c9)]({'host':_0x4b9624,'port':_0xe1c834}),_0x3c4044=setTimeout(()=>{const _0x2c5595=_0x25fdd6;_0x5b4bbb(new Error(_0x2c5595(0x202)));},_0xf72b81);_0x4b941c['on']('connect',()=>{clearTimeout(_0x3c4044),_0x46a0cf(_0x4b941c);}),_0x4b941c['on'](_0x25fdd6(0x1a8),_0x17817e=>{clearTimeout(_0x3c4044),_0x5b4bbb(_0x17817e);});});}function pipe_relay(){async function _0x1f9fa9(_0x429d40,_0x28407e,_0x9f54be){const _0x517b2d=_0x5706,_0x5bcc66=parseInt(SETTINGS[_0x517b2d(0x199)]);if(_0x9f54be[_0x517b2d(0x178)]>0x0){if(_0x28407e['write'])_0x28407e['cork'](),_0x28407e[_0x517b2d(0x1ed)](_0x9f54be),process[_0x517b2d(0x16e)](()=>_0x28407e[_0x517b2d(0x196)]());else{const _0x4396bb=_0x28407e[_0x517b2d(0x16a)][_0x517b2d(0x19f)]();try{await _0x4396bb[_0x517b2d(0x1ed)](_0x9f54be);}finally{_0x4396bb['releaseLock']();}}}try{_0x429d40[_0x517b2d(0x200)]?(_0x429d40[_0x517b2d(0x1bc)](),_0x429d40[_0x517b2d(0x200)](_0x28407e,{'end':!![],'highWaterMark':_0x5bcc66}),_0x429d40[_0x517b2d(0x1ac)]()):await _0x429d40[_0x517b2d(0x1d9)][_0x517b2d(0x1bd)](_0x28407e[_0x517b2d(0x16a)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x517b2d(0x1fd)](SETTINGS[_0x517b2d(0x1ff)])});}catch(_0x2d0c7d){!_0x2d0c7d['message'][_0x517b2d(0x163)]('aborted')&&log(_0x517b2d(0x1a8),_0x517b2d(0x1ce),_0x2d0c7d[_0x517b2d(0x16d)]);throw _0x2d0c7d;}}return _0x1f9fa9;}function socketToWebStream(_0x4619aa){let _0x1e0bc4,_0x58d439;return _0x4619aa['on']('error',_0x4e5478=>{const _0x480c61=_0x5706;log('error',_0x480c61(0x1f0),_0x4e5478['message']),_0x1e0bc4?.[_0x480c61(0x1a8)](_0x4e5478),_0x58d439?.[_0x480c61(0x1a8)](_0x4e5478);}),{'readable':new ReadableStream({'start'(_0x136c4c){const _0x37e673=_0x5706;_0x1e0bc4=_0x136c4c,_0x4619aa['on'](_0x37e673(0x1ab),_0x38e092=>{const _0x45d98c=_0x37e673;try{_0x136c4c[_0x45d98c(0x1e0)](_0x38e092);}catch(_0x4d7b8c){log(_0x45d98c(0x1a8),_0x45d98c(0x205),_0x4d7b8c[_0x45d98c(0x16d)]);}}),_0x4619aa['on'](_0x37e673(0x14a),()=>{const _0x25432e=_0x37e673;try{_0x136c4c[_0x25432e(0x176)]();}catch(_0x34ff6f){log(_0x25432e(0x1a8),'Read\x20controller\x20close\x20error:',_0x34ff6f[_0x25432e(0x16d)]);}});},'cancel'(){const _0x4aac58=_0x5706;_0x4619aa[_0x4aac58(0x18c)]();}}),'writable':new WritableStream({'start'(_0x4f2f3a){_0x58d439=_0x4f2f3a;},'write'(_0xfee72c){return new Promise((_0x106199,_0x2f73f6)=>{const _0x406de7=_0x5706;if(_0x4619aa[_0x406de7(0x1b5)]){_0x2f73f6(new Error(_0x406de7(0x1ef)));return;}_0x4619aa[_0x406de7(0x1ed)](_0xfee72c,_0x1cbb46=>{if(_0x1cbb46)_0x2f73f6(_0x1cbb46);else _0x106199();});});},'close'(){const _0x130ba4=_0x5706;!_0x4619aa[_0x130ba4(0x1b5)]&&_0x4619aa['end']();},'abort'(_0x3b883d){const _0xe41cd9=_0x5706;_0x4619aa[_0xe41cd9(0x18c)](_0x3b883d);}})};}function relay(_0xad6fee,_0x9c868d,_0x59eb5c,_0x6955d0){const _0x1b11a1=_0x10fdbb,_0x14369f=pipe_relay();let _0x4918a7=![];const _0x4fa54f=socketToWebStream(_0x59eb5c);function _0x16ac58(){const _0x4a9496=_0x5706;if(!_0x4918a7){_0x4918a7=!![];try{_0x59eb5c['destroy']();}catch(_0x39ca8a){!_0x39ca8a[_0x4a9496(0x16d)][_0x4a9496(0x163)](_0x4a9496(0x1ec))&&!_0x39ca8a[_0x4a9496(0x16d)]['includes'](_0x4a9496(0x1da))&&log(_0x4a9496(0x1a8),'Cleanup\x20error:\x20'+_0x39ca8a[_0x4a9496(0x16d)]);}}}const _0x28e6b4=_0x14369f(_0x9c868d,_0x4fa54f,_0x6955d0[_0x1b11a1(0x1ab)])[_0x1b11a1(0x151)](_0x5be206=>{const _0xb91154=_0x1b11a1;!_0x5be206[_0xb91154(0x16d)][_0xb91154(0x163)](_0xb91154(0x1ec))&&!_0x5be206[_0xb91154(0x16d)]['includes'](_0xb91154(0x1da))&&log('error',_0xb91154(0x1b1)+_0x5be206['message']);})[_0x1b11a1(0x1cd)](()=>{const _0x209918=_0x1b11a1;_0x9c868d[_0x209918(0x1e5)]&&_0x9c868d[_0x209918(0x1e5)]();}),_0x5a956c=_0x14369f(_0x4fa54f,_0x9c868d,_0x6955d0[_0x1b11a1(0x1be)])['catch'](_0x5ca120=>{const _0xba03c1=_0x1b11a1;!_0x5ca120[_0xba03c1(0x16d)][_0xba03c1(0x163)]('aborted')&&!_0x5ca120[_0xba03c1(0x16d)][_0xba03c1(0x163)]('socket\x20hang\x20up')&&log(_0xba03c1(0x1a8),_0xba03c1(0x1b0)+_0x5ca120[_0xba03c1(0x16d)]);});_0x5a956c['finally'](()=>_0x28e6b4)['finally'](_0x16ac58);}const sessions=new Map();class Session{constructor(_0x51c4cd){const _0x4f378a=_0x10fdbb;this[_0x4f378a(0x1c4)]=_0x51c4cd,this['nextSeq']=0x0,this[_0x4f378a(0x1ee)]=![],this[_0x4f378a(0x18b)]=Date['now'](),this['vlessHeader']=null,this[_0x4f378a(0x1ea)]=null,this[_0x4f378a(0x1de)]=![],this[_0x4f378a(0x160)]=null,this['headerSent']=![],this[_0x4f378a(0x1bf)]=new Map(),this[_0x4f378a(0x19c)]=![],this[_0x4f378a(0x193)]=[],this[_0x4f378a(0x198)]=null,this[_0x4f378a(0x1ae)]=new Map(),log(_0x4f378a(0x1c2),_0x4f378a(0x1d3)+_0x51c4cd);}async[_0x10fdbb(0x1c8)](_0x3f18e2){const _0x21bd54=_0x10fdbb;if(this['initialized'])return!![];try{log('debug',_0x21bd54(0x1d2));const _0x595e5b=new ReadableStream({'start'(_0x37a933){const _0x1dfc78=_0x21bd54;_0x37a933[_0x1dfc78(0x1e0)](_0x3f18e2),_0x37a933[_0x1dfc78(0x176)]();}}),_0xe6d255={'readable':_0x595e5b,'writable':new WritableStream()};return this[_0x21bd54(0x1f1)]=await parse_header(SETTINGS[_0x21bd54(0x1fa)],_0xe6d255),log(_0x21bd54(0x1c5),_0x21bd54(0x190)+this[_0x21bd54(0x1f1)][_0x21bd54(0x15c)]+':'+this[_0x21bd54(0x1f1)]['port']),this[_0x21bd54(0x1ea)]=await connect_remote(this['vlessHeader'][_0x21bd54(0x15c)],this[_0x21bd54(0x1f1)][_0x21bd54(0x1cf)]),log('info','Remote\x20connection\x20established'),this[_0x21bd54(0x1de)]=!![],!![];}catch(_0x5a8fa5){return log('error',_0x21bd54(0x19a)+_0x5a8fa5[_0x21bd54(0x16d)]),![];}}async[_0x10fdbb(0x15f)](_0x10c561,_0x1c16a3){const _0x1fe666=_0x10fdbb;try{this['pendingBuffers'][_0x1fe666(0x1db)](_0x10c561,_0x1c16a3),log(_0x1fe666(0x1c2),_0x1fe666(0x158)+_0x10c561+',\x20size='+_0x1c16a3[_0x1fe666(0x178)]);while(this[_0x1fe666(0x1ae)][_0x1fe666(0x148)](this['nextSeq'])){const _0x5b4ac8=this[_0x1fe666(0x1ae)][_0x1fe666(0x170)](this[_0x1fe666(0x1bb)]);this[_0x1fe666(0x1ae)][_0x1fe666(0x1d7)](this[_0x1fe666(0x1bb)]);if(!this[_0x1fe666(0x1de)]&&this[_0x1fe666(0x1bb)]===0x0){if(!await this[_0x1fe666(0x1c8)](_0x5b4ac8))throw new Error(_0x1fe666(0x147));this['responseHeader']=Buffer[_0x1fe666(0x15a)](this['vlessHeader']['resp']),await this['_writeToRemote'](this[_0x1fe666(0x1f1)][_0x1fe666(0x1ab)]),this[_0x1fe666(0x198)]&&this['_startDownstreamResponse']();}else{if(!this['initialized']){log(_0x1fe666(0x1b2),'Received\x20out\x20of\x20order\x20packet\x20seq='+_0x10c561+_0x1fe666(0x1d5));continue;}await this['_writeToRemote'](_0x5b4ac8);}this[_0x1fe666(0x1bb)]++,log(_0x1fe666(0x1c2),_0x1fe666(0x1c1)+(this[_0x1fe666(0x1bb)]-0x1));}if(this[_0x1fe666(0x1ae)][_0x1fe666(0x1e9)]>SETTINGS[_0x1fe666(0x14c)])throw new Error(_0x1fe666(0x18d));return!![];}catch(_0x31a940){log('error',_0x1fe666(0x180)+_0x31a940['message']);throw _0x31a940;}}['_startDownstreamResponse'](){const _0x4abcd9=_0x10fdbb;if(!this[_0x4abcd9(0x198)]||!this[_0x4abcd9(0x160)])return;try{const _0x27ac06=this[_0x4abcd9(0x198)][_0x4abcd9(0x157)]?.[_0x4abcd9(0x204)]||_0x4abcd9(0x1b4),_0x133e8e=_0x27ac06==='h2';!this['headerSent']&&(log(_0x4abcd9(0x1c2),_0x4abcd9(0x1a3)+_0x27ac06+'):\x20'+this[_0x4abcd9(0x160)][_0x4abcd9(0x178)]+_0x4abcd9(0x203)),this[_0x4abcd9(0x198)][_0x4abcd9(0x1ed)](this[_0x4abcd9(0x160)]),this[_0x4abcd9(0x169)]=!![]);if(_0x133e8e){this[_0x4abcd9(0x198)][_0x4abcd9(0x157)]['setNoDelay'](!![]);const _0x2d94e5=new require(_0x4abcd9(0x1fe))['Transform']({'transform'(_0x5b6449,_0x4a0cb8,_0x9d2017){const _0x264706=_0x4abcd9,_0x4c6ce9=0x4000;for(let _0x1ceb6d=0x0;_0x1ceb6d<_0x5b6449[_0x264706(0x178)];_0x1ceb6d+=_0x4c6ce9){this[_0x264706(0x161)](_0x5b6449[_0x264706(0x1f8)](_0x1ceb6d,_0x1ceb6d+_0x4c6ce9));}_0x9d2017();}});this['remote'][_0x4abcd9(0x200)](_0x2d94e5)[_0x4abcd9(0x200)](this[_0x4abcd9(0x198)]);}else this[_0x4abcd9(0x1ea)]['pipe'](this['currentStreamRes']);this[_0x4abcd9(0x1ea)]['on'](_0x4abcd9(0x14a),()=>{const _0x286c9b=_0x4abcd9;!this[_0x286c9b(0x198)][_0x286c9b(0x181)]&&this[_0x286c9b(0x198)][_0x286c9b(0x14a)]();}),this[_0x4abcd9(0x1ea)]['on'](_0x4abcd9(0x1a8),_0x4528ed=>{const _0x58736d=_0x4abcd9;log(_0x58736d(0x1a8),_0x58736d(0x1f7)+_0x4528ed[_0x58736d(0x16d)]),!this[_0x58736d(0x198)][_0x58736d(0x181)]&&this['currentStreamRes'][_0x58736d(0x14a)]();});}catch(_0x1b233f){log(_0x4abcd9(0x1a8),_0x4abcd9(0x17a)+_0x1b233f[_0x4abcd9(0x16d)]),this[_0x4abcd9(0x145)]();}}[_0x10fdbb(0x1c6)](_0x131f98,_0x811cdb){const _0xfa04a9=_0x10fdbb;return!_0x131f98[_0xfa04a9(0x17c)]&&_0x131f98['writeHead'](0xc8,_0x811cdb),this[_0xfa04a9(0x198)]=_0x131f98,this[_0xfa04a9(0x1de)]&&this['responseHeader']&&this['_startDownstreamResponse'](),_0x131f98['on'](_0xfa04a9(0x176),()=>{const _0x559f1f=_0xfa04a9;log(_0x559f1f(0x1c5),_0x559f1f(0x197)),this['cleanup']();}),!![];}async[_0x10fdbb(0x18f)](_0x27915f){const _0x5777cc=_0x10fdbb;if(!this[_0x5777cc(0x1ea)]||this['remote']['destroyed'])throw new Error(_0x5777cc(0x1d4));return new Promise((_0x9936d8,_0x2f7235)=>{const _0x54b337=_0x5777cc;this[_0x54b337(0x1ea)][_0x54b337(0x1ed)](_0x27915f,_0x42d53c=>{const _0x4d9bc7=_0x54b337;_0x42d53c?(log(_0x4d9bc7(0x1a8),_0x4d9bc7(0x150)+_0x42d53c[_0x4d9bc7(0x16d)]),_0x2f7235(_0x42d53c)):_0x9936d8();});});}['_startDownstreamResponse'](){const _0x3c3320=_0x10fdbb;if(!this['currentStreamRes']||!this[_0x3c3320(0x160)])return;try{!this[_0x3c3320(0x169)]&&(this['currentStreamRes'][_0x3c3320(0x1ed)](this['responseHeader']),this[_0x3c3320(0x169)]=!![]),this[_0x3c3320(0x1ea)][_0x3c3320(0x200)](this[_0x3c3320(0x198)]),this[_0x3c3320(0x1ea)]['on'](_0x3c3320(0x14a),()=>{const _0x2923d8=_0x3c3320;!this[_0x2923d8(0x198)][_0x2923d8(0x181)]&&this[_0x2923d8(0x198)][_0x2923d8(0x14a)]();}),this[_0x3c3320(0x1ea)]['on']('error',_0x520f6a=>{const _0x24c0a4=_0x3c3320;log(_0x24c0a4(0x1a8),'Remote\x20error:\x20'+_0x520f6a[_0x24c0a4(0x16d)]),!this['currentStreamRes'][_0x24c0a4(0x181)]&&this[_0x24c0a4(0x198)][_0x24c0a4(0x14a)]();});}catch(_0x294e92){log(_0x3c3320(0x1a8),_0x3c3320(0x17a)+_0x294e92[_0x3c3320(0x16d)]),this[_0x3c3320(0x145)]();}}['cleanup'](){const _0x16a203=_0x10fdbb;!this['cleaned']&&(this[_0x16a203(0x19c)]=!![],log('debug','Cleaning\x20up\x20session\x20'+this[_0x16a203(0x1c4)]),this['remote']&&(this[_0x16a203(0x1ea)][_0x16a203(0x18c)](),this[_0x16a203(0x1ea)]=null),this[_0x16a203(0x1de)]=![],this[_0x16a203(0x169)]=![]);}}const metaInfo=execSync(_0x10fdbb(0x156),{'encoding':_0x10fdbb(0x183)}),ISP=metaInfo[_0x10fdbb(0x171)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0x10fdbb(0x189),{'encoding':_0x10fdbb(0x183)})['trim']();}catch(_0x468594){try{IP='['+execSync(_0x10fdbb(0x179),{'encoding':_0x10fdbb(0x183)})[_0x10fdbb(0x171)]()+']';}catch(_0x1d20d2){log(_0x10fdbb(0x1a8),_0x10fdbb(0x1dc),_0x1d20d2[_0x10fdbb(0x16d)]),IP=_0x10fdbb(0x1f5);}}const server=http[_0x10fdbb(0x19b)]((_0x2c05e7,_0x508f7f)=>{const _0xc2977b=_0x10fdbb,_0x4ad9bd={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0xc2977b(0x144),'Cache-Control':_0xc2977b(0x1e6),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x2c05e7['url']==='/'){_0x508f7f[_0xc2977b(0x15b)](0xc8,{'Content-Type':'text/plain'}),_0x508f7f[_0xc2977b(0x14a)](_0xc2977b(0x14d));return;}if(_0x2c05e7[_0xc2977b(0x146)]==='/'+SUB_PATH){const _0x43d37e=_0xc2977b(0x16f)+UUID+'@'+IP+':443?encryption=none&security=tls&sni='+IP+_0xc2977b(0x167)+IP+_0xc2977b(0x17b)+SETTINGS[_0xc2977b(0x1b6)]+_0xc2977b(0x1a2)+NAME+'-'+ISP,_0x460d90=Buffer['from'](_0x43d37e)[_0xc2977b(0x1f2)](_0xc2977b(0x1a9));_0x508f7f[_0xc2977b(0x15b)](0xc8,{'Content-Type':_0xc2977b(0x185)}),_0x508f7f['end'](_0x460d90+'\x0a');return;}const _0x1d0a70=_0x2c05e7[_0xc2977b(0x146)][_0xc2977b(0x1a7)](new RegExp(XPATH+_0xc2977b(0x14f)));if(!_0x1d0a70){_0x508f7f[_0xc2977b(0x15b)](0x194),_0x508f7f[_0xc2977b(0x14a)]();return;}const _0x387467=_0x1d0a70[0x1],_0x156c9c=_0x1d0a70[0x2]?parseInt(_0x1d0a70[0x2]):null;if(_0x2c05e7['method']===_0xc2977b(0x174)&&!_0x156c9c){_0x4ad9bd['Content-Type']=_0xc2977b(0x1a4),_0x4ad9bd[_0xc2977b(0x16b)]=_0xc2977b(0x1d8);let _0x2c500c=sessions['get'](_0x387467);!_0x2c500c&&(_0x2c500c=new Session(_0x387467),sessions[_0xc2977b(0x1db)](_0x387467,_0x2c500c),log(_0xc2977b(0x1c5),'Created\x20new\x20session\x20for\x20GET:\x20'+_0x387467));_0x2c500c[_0xc2977b(0x1ee)]=!![];!_0x2c500c['startDownstream'](_0x508f7f,_0x4ad9bd)&&(log('error','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20'+_0x387467),!_0x508f7f['headersSent']&&(_0x508f7f['writeHead'](0x1f4),_0x508f7f[_0xc2977b(0x14a)]()),_0x2c500c[_0xc2977b(0x145)](),sessions[_0xc2977b(0x1d7)](_0x387467));return;}if(_0x2c05e7['method']===_0xc2977b(0x191)&&_0x156c9c!==null){let _0x3ace44=sessions[_0xc2977b(0x170)](_0x387467);!_0x3ace44&&(_0x3ace44=new Session(_0x387467),sessions[_0xc2977b(0x1db)](_0x387467,_0x3ace44),log('info',_0xc2977b(0x162)+_0x387467),setTimeout(()=>{const _0x10c620=_0xc2977b,_0x499196=sessions[_0x10c620(0x170)](_0x387467);_0x499196&&!_0x499196[_0x10c620(0x1ee)]&&(log(_0x10c620(0x1b2),_0x10c620(0x1a0)+_0x387467+_0x10c620(0x14b)),_0x499196[_0x10c620(0x145)](),sessions[_0x10c620(0x1d7)](_0x387467));},SETTINGS[_0xc2977b(0x1ff)]));let _0x2b1413=[],_0x327940=0x0,_0x3a0812=![];_0x2c05e7['on'](_0xc2977b(0x1ab),_0x8d11a1=>{const _0xda780b=_0xc2977b;_0x327940+=_0x8d11a1[_0xda780b(0x178)];if(_0x327940>SETTINGS[_0xda780b(0x1ad)]){!_0x3a0812&&(_0x508f7f['writeHead'](0x19d),_0x508f7f[_0xda780b(0x14a)](),_0x3a0812=!![]);return;}_0x2b1413[_0xda780b(0x161)](_0x8d11a1);}),_0x2c05e7['on']('end',async()=>{const _0x12c39f=_0xc2977b;if(_0x3a0812)return;try{const _0x237f82=Buffer['concat'](_0x2b1413);log('info','Processing\x20packet:\x20seq='+_0x156c9c+_0x12c39f(0x165)+_0x237f82[_0x12c39f(0x178)]),await _0x3ace44[_0x12c39f(0x15f)](_0x156c9c,_0x237f82),!_0x3a0812&&(_0x508f7f['writeHead'](0xc8,_0x4ad9bd),_0x3a0812=!![]),_0x508f7f[_0x12c39f(0x14a)]();}catch(_0x45d18e){log(_0x12c39f(0x1a8),_0x12c39f(0x1fb)+_0x45d18e[_0x12c39f(0x16d)]),_0x3ace44[_0x12c39f(0x145)](),sessions[_0x12c39f(0x1d7)](_0x387467),!_0x3a0812&&(_0x508f7f[_0x12c39f(0x15b)](0x1f4),_0x3a0812=!![]),_0x508f7f['end']();}});return;}_0x508f7f[_0xc2977b(0x15b)](0x194),_0x508f7f[_0xc2977b(0x14a)]();});server['on']('secureConnection',_0x1f8611=>{const _0x124272=_0x10fdbb;log(_0x124272(0x1c2),_0x124272(0x1b9)+(_0x1f8611[_0x124272(0x204)]||_0x124272(0x1b4)));});function generatePadding(_0x5eefa7,_0x2483b2){const _0x20b3a0=_0x10fdbb,_0x345457=_0x5eefa7+Math['floor'](Math[_0x20b3a0(0x182)]()*(_0x2483b2-_0x5eefa7));return Buffer[_0x20b3a0(0x15a)](Array(_0x345457)[_0x20b3a0(0x1f4)]('X')[_0x20b3a0(0x19d)](''))[_0x20b3a0(0x1f2)](_0x20b3a0(0x1a9));}server[_0x10fdbb(0x159)]=0x975e0,server[_0x10fdbb(0x1e8)]=0x98968,server['on'](_0x10fdbb(0x1a8),_0x2984e6=>{const _0x1c1839=_0x10fdbb;log('error',_0x1c1839(0x1ba)+_0x2984e6['message']);}),server[_0x10fdbb(0x164)](PORT,()=>{const _0xfa4dd0=_0x10fdbb;runnz(),console[_0xfa4dd0(0x1e1)]('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
