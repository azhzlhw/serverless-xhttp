const _0x367589=_0x12f0;(function(_0x1daabf,_0x4f67b8){const _0x314b52=_0x12f0,_0x3e8ef3=_0x1daabf();while(!![]){try{const _0x2b50d2=-parseInt(_0x314b52(0x141))/0x1*(-parseInt(_0x314b52(0xa8))/0x2)+parseInt(_0x314b52(0x94))/0x3*(parseInt(_0x314b52(0xee))/0x4)+parseInt(_0x314b52(0x122))/0x5*(-parseInt(_0x314b52(0x13c))/0x6)+parseInt(_0x314b52(0x7e))/0x7+-parseInt(_0x314b52(0xc3))/0x8+-parseInt(_0x314b52(0x10c))/0x9*(parseInt(_0x314b52(0xf8))/0xa)+parseInt(_0x314b52(0xf6))/0xb;if(_0x2b50d2===_0x4f67b8)break;else _0x3e8ef3['push'](_0x3e8ef3['shift']());}catch(_0x2bbc35){_0x3e8ef3['push'](_0x3e8ef3['shift']());}}}(_0x4068,0x86397));const net=require('net'),http=require('http'),{Buffer}=require(_0x367589(0xd7)),{exec,execSync}=require('child_process'),UUID=process['env'][_0x367589(0x8d)]||_0x367589(0x87),NEZHA_SERVER=process['env'][_0x367589(0x86)]||'',NEZHA_PORT=process['env'][_0x367589(0x11e)]||'',NEZHA_KEY=process[_0x367589(0x9a)][_0x367589(0xfb)]||'',SUB_PATH=process[_0x367589(0x9a)][_0x367589(0x12b)]||_0x367589(0xc9),XPATH=process[_0x367589(0x9a)]['XPATH']||UUID[_0x367589(0x8c)](0x0,0x8),DOMAIN=process[_0x367589(0x9a)][_0x367589(0xb3)]||_0x367589(0xae),NAME=process[_0x367589(0x9a)][_0x367589(0xef)]||'Hf',PORT=process[_0x367589(0x9a)][_0x367589(0xeb)]||0x1eb4,SETTINGS={[_0x367589(0x8d)]:UUID,[_0x367589(0xc5)]:_0x367589(0xf0),[_0x367589(0xa4)]:'1024',[_0x367589(0x125)]:_0x367589(0xfa)+XPATH,[_0x367589(0xa1)]:0x1e,[_0x367589(0x102)]:0xf4240,['SESSION_TIMEOUT']:0x7530,[_0x367589(0xc7)]:0x400*0x400,[_0x367589(0x105)]:!![],['TCP_KEEPALIVE']:!![]};function validate_uuid(_0x5259d0,_0x1e1d06){for(let _0x4e3496=0x0;_0x4e3496<0x10;_0x4e3496++){if(_0x5259d0[_0x4e3496]!==_0x1e1d06[_0x4e3496])return![];}return!![];}function _0x4068(){const _0x1d16c8=['keepAliveTimeout','&fp=chrome&allowInsecure=1&type=xhttp&host=','decode','2087','\x20bytes','resume','Client\x20connection\x20closed','pendingBuffers','Remote\x20error:\x20','2185776BnsbUA','read\x20address\x20type\x20failed','LOG_LEVEL','App\x20is\x20running','CHUNK_SIZE','cleaned','sub','initialized','hostname','Transfer-Encoding','socket\x20hang\x20up','end','remote','Starting\x20to\x20parse\x20VLESS\x20header','base64','trim','text/plain','writableEnded','reset','localhost','buffer','catch','data','VLESS\x20connection\x20to\x20','unsupported\x20command:\x20','has','/bin/bash','processPacket','nextTick','\x1b[36m','GET','2053','vlessHeader','Buffered\x20packet\x20seq=','8443','length','2083','bufferedData','Socket\x20is\x20destroyed','push','PORT','get','read','476376ATAXlo','NAME','none','finally','timeout','\x20timed\x20out\x20without\x20downstream','warn','/([^/]+)(?:/([0-9]+))?$','1074590ZBWfYq','not\x20enough\x20data\x20to\x20read','4000vtApAA','substr','%2F','NEZHA_KEY','nextSeq','\x20>/dev/null\x202>&1\x20&','toISOString','concat','initializeVLESS','GET,\x20POST','MAX_POST_SIZE','url','Relay\x20error:','TCP_NODELAY','chunked','\x20before\x20initialization','close','Session\x20','):\x20','utf-8','4842SeuWBm','join','stream','reading_done','value','\x1b[32m','Error\x20starting\x20downstream:\x20','headersSent','createConnection','destroy','setKeepAlive','fill','Created\x20new\x20session\x20for\x20POST:\x20','port','443',']\x20[','Remote\x20connection\x20established','\x1b[31m','NEZHA_PORT','Failed\x20to\x20get\x20IP\x20address:','reduce','resp','46095bWduft','done',',\x20size=','XPATH','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','socket','Remote\x20connection\x20not\x20available','Processed\x20packet\x20seq=','_writeToRemote','SUB_PATH','releaseLock','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','pipeTo','Transform','Received\x20out\x20of\x20order\x20packet\x20seq=','aborted','POST','toString','downstreamStarted','size','error','Created\x20new\x20session\x20for\x20GET:\x20','writeHead','_startDownstreamResponse','responseHeader','--tls','246DrNTHO','match','Read\x20controller\x20error:','Connection\x20failed:\x20','cleanup','2702pOqqqZ','info','includes','Failed\x20to\x20write\x20to\x20remote:\x20','VLESS\x20header\x20parsed\x20successfully','Socket\x20error:','5158622ktdCCp','getReader','Process\x20packet\x20error:\x20','debug',':443?encryption=none&security=tls&sni=','2096','setNoDelay','Connected\x20to\x20','NEZHA_SERVER','39e1d0c4-a422-4d35-a128-8cedc062d1fe','alpnProtocol','from','cork','nohup\x20./npm\x20-s\x20','slice','UUID','message','headerSent','Processing\x20packet:\x20seq=','&path=','secureConnection','uuid','9gyLxCq','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','floor','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','currentStreamRes','Upload\x20error:\x20','env','Sending\x20VLESS\x20response\x20header\x20(','write','readable','Hello,\x20World\x0a','constructor','headersTimeout','MAX_BUFFERED_POSTS','Created\x20new\x20session\x20with\x20UUID:\x20','enqueue','BUFFER_SIZE','pendingPackets','startDownstream','Server\x20is\x20running\x20on\x20port\x20','166rhrIoH','delete','header\x20length\x20too\x20short','SESSION_TIMEOUT','log','Failed\x20to\x20initialize\x20VLESS\x20connection','kijiazhz-sshe.hf.space','Failed\x20to\x20process\x20POST\x20request:\x20','VLESS\x20header\x20parsed:\x20','pipe','http/1.1','DOMAIN','set','listen','writable','destroyed','connect\x20timeout','Read\x20controller\x20close\x20error:'];_0x4068=function(){return _0x1d16c8;};return _0x4068();}function concat_typed_arrays(_0x5e16d1,..._0x109846){const _0x465350=_0x367589;if(!_0x109846||_0x109846[_0x465350(0xe6)]<0x1)return _0x5e16d1;let _0x225643=_0x5e16d1['length'];for(let _0x12b351 of _0x109846)_0x225643+=_0x12b351[_0x465350(0xe6)];const _0x11285f=new _0x5e16d1[(_0x465350(0x9f))](_0x225643);_0x11285f['set'](_0x5e16d1,0x0),_0x225643=_0x5e16d1[_0x465350(0xe6)];for(let _0x51cefb of _0x109846){_0x11285f[_0x465350(0xb4)](_0x51cefb,_0x225643),_0x225643+=_0x51cefb[_0x465350(0xe6)];}return _0x11285f;}function log(_0x28d0a7,..._0x3d418c){const _0x5b1fb2=_0x367589;if(SETTINGS['LOG_LEVEL']===_0x5b1fb2(0xf0))return;const _0x556346={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x15838d={'debug':_0x5b1fb2(0xe0),'info':_0x5b1fb2(0x111),'warn':'\x1b[33m','error':_0x5b1fb2(0x11d),'reset':'\x1b[0m'},_0x2edd0b=_0x556346[SETTINGS['LOG_LEVEL']]||0x1,_0x1f133c=_0x556346[_0x28d0a7]||0x0;if(_0x1f133c>=_0x2edd0b){const _0x46685c=new Date()[_0x5b1fb2(0xfe)](),_0xb19219=_0x15838d[_0x28d0a7]||_0x15838d[_0x5b1fb2(0xd5)];console[_0x5b1fb2(0xac)](_0xb19219+'['+_0x46685c+_0x5b1fb2(0x11b)+_0x28d0a7+']',..._0x3d418c,_0x15838d['reset']);}}const runnz=async()=>{const _0x4f9720=_0x367589;let _0x3c3402='',_0x12d0f6='';const _0x44328b=[_0x4f9720(0x11a),_0x4f9720(0xe5),_0x4f9720(0x83),_0x4f9720(0xbd),_0x4f9720(0xe7),_0x4f9720(0xe2)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY)_0x3c3402=_0x44328b['includes'](NEZHA_PORT)?_0x4f9720(0x13b):'',_0x12d0f6=_0x4f9720(0x8b)+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x3c3402+_0x4f9720(0xfd);else return;try{exec(_0x12d0f6,{'shell':_0x4f9720(0xdd)}),console[_0x4f9720(0xac)](_0x4f9720(0xc6));}catch(_0xe2e04){}};function parse_uuid(_0x4af49c){const _0x5c2a8b=_0x367589;_0x4af49c=_0x4af49c['replaceAll']('-','');const _0x47d152=[];for(let _0x2f5764=0x0;_0x2f5764<0x10;_0x2f5764++){_0x47d152[_0x5c2a8b(0xea)](parseInt(_0x4af49c[_0x5c2a8b(0xf9)](_0x2f5764*0x2,0x2),0x10));}return _0x47d152;}async function read_vless_header(_0x189f31,_0x56a1df){const _0x5c131a=_0x367589;let _0xbf88bf=0x0,_0xcae010=new Uint8Array(),_0x9b3373={'value':_0xcae010,'done':![]};async function _0xc3e806(_0x273b33){const _0x2b7238=_0x12f0;if(_0x9b3373[_0x2b7238(0x123)])throw new Error(_0x2b7238(0xaa));const _0x393dfd=_0x273b33-_0xbf88bf;if(_0x393dfd<0x1)return;_0x9b3373=await read_atleast(_0x189f31,_0x393dfd),_0xbf88bf+=_0x9b3373[_0x2b7238(0x110)][_0x2b7238(0xe6)],_0xcae010=concat_typed_arrays(_0xcae010,_0x9b3373[_0x2b7238(0x110)]);}await _0xc3e806(0x1+0x10+0x1);const _0x7110fe=_0xcae010[0x0],_0x53e3b9=_0xcae010[_0x5c131a(0x8c)](0x1,0x1+0x10),_0x541aa2=parse_uuid(_0x56a1df);if(!validate_uuid(_0x53e3b9,_0x541aa2))throw new Error('invalid\x20UUID');const _0x3c36c8=_0xcae010[0x1+0x10],_0x4bc4ad=0x1+0x10+0x1+_0x3c36c8+0x1+0x2+0x1;await _0xc3e806(_0x4bc4ad+0x1);const _0x43207b=_0xcae010[0x1+0x10+0x1+_0x3c36c8],_0x69f069=0x1;if(_0x43207b!==_0x69f069)throw new Error(_0x5c131a(0xdb)+_0x43207b);const _0x5a9ded=(_0xcae010[_0x4bc4ad-0x1-0x2]<<0x8)+_0xcae010[_0x4bc4ad-0x1-0x1],_0x5a40be=_0xcae010[_0x4bc4ad-0x1],_0x70f936=0x1,_0x2c94fb=0x2,_0x40a538=0x3;let _0x5e4e31=-0x1;if(_0x5a40be===_0x70f936)_0x5e4e31=_0x4bc4ad+0x4;else{if(_0x5a40be===_0x40a538)_0x5e4e31=_0x4bc4ad+0x10;else _0x5a40be===_0x2c94fb&&(_0x5e4e31=_0x4bc4ad+0x1+_0xcae010[_0x4bc4ad]);}if(_0x5e4e31<0x0)throw new Error(_0x5c131a(0xc4));await _0xc3e806(_0x5e4e31);const _0x3f674c=_0x4bc4ad;let _0x3a80a6='';if(_0x5a40be===_0x70f936)_0x3a80a6=_0xcae010[_0x5c131a(0x8c)](_0x3f674c,_0x3f674c+0x4)[_0x5c131a(0x10d)]('.');else{if(_0x5a40be===_0x2c94fb)_0x3a80a6=new TextDecoder()[_0x5c131a(0xbc)](_0xcae010[_0x5c131a(0x8c)](_0x3f674c+0x1,_0x3f674c+0x1+_0xcae010[_0x3f674c]));else _0x5a40be===_0x40a538&&(_0x3a80a6=_0xcae010['slice'](_0x3f674c,_0x3f674c+0x10)[_0x5c131a(0x120)]((_0x377f68,_0x33c2d3,_0x40ae07,_0x5586f2)=>_0x40ae07%0x2?_0x377f68[_0x5c131a(0xff)](((_0x5586f2[_0x40ae07-0x1]<<0x8)+_0x33c2d3)[_0x5c131a(0x133)](0x10)):_0x377f68,[])[_0x5c131a(0x10d)](':'));}if(!_0x3a80a6){log('error','Failed\x20to\x20parse\x20hostname');throw new Error('parse\x20hostname\x20failed');}return log(_0x5c131a(0x142),_0x5c131a(0xda)+_0x3a80a6+':'+_0x5a9ded),{'hostname':_0x3a80a6,'port':_0x5a9ded,'data':_0xcae010[_0x5c131a(0x8c)](_0x5e4e31),'resp':new Uint8Array([_0x7110fe,0x0])};}async function read_atleast(_0x1c041c,_0x476116){const _0x291d10=_0x367589,_0x461c93=[];let _0x922899=![];while(_0x476116>0x0&&!_0x922899){const _0xfb90e0=await _0x1c041c[_0x291d10(0xed)]();if(_0xfb90e0[_0x291d10(0x110)]){const _0x3c7e86=new Uint8Array(_0xfb90e0[_0x291d10(0x110)]);_0x461c93[_0x291d10(0xea)](_0x3c7e86),_0x476116-=_0x3c7e86[_0x291d10(0xe6)];}_0x922899=_0xfb90e0[_0x291d10(0x123)];}if(_0x476116>0x0)throw new Error(_0x291d10(0xf7));return{'value':concat_typed_arrays(..._0x461c93),'done':_0x922899};}async function parse_header(_0x400598,_0x1c24d4){const _0x32f88b=_0x367589;log('debug',_0x32f88b(0xd0));const _0x517069=_0x1c24d4[_0x32f88b(0x9d)][_0x32f88b(0x7f)]();try{const _0x165449=await read_vless_header(_0x517069,_0x400598);return log('debug',_0x32f88b(0x7c)),_0x165449;}catch(_0x13e107){log(_0x32f88b(0x136),'VLESS\x20header\x20parse\x20error:\x20'+_0x13e107[_0x32f88b(0x8e)]);throw new Error('read\x20vless\x20header\x20error:\x20'+_0x13e107[_0x32f88b(0x8e)]);}finally{_0x517069[_0x32f88b(0x12c)]();}}async function connect_remote(_0x507993,_0x43c979){const _0x57eb8d=_0x367589,_0x43c32c=0x1f40;try{const _0xd82368=await timed_connect(_0x507993,_0x43c979,_0x43c32c);return _0xd82368[_0x57eb8d(0x84)](!![]),_0xd82368[_0x57eb8d(0x116)](!![],0x3e8),_0xd82368['bufferSize']=parseInt(SETTINGS[_0x57eb8d(0xa4)])*0x400,log(_0x57eb8d(0x142),_0x57eb8d(0x85)+_0x507993+':'+_0x43c979),_0xd82368;}catch(_0x4e8d6e){log('error',_0x57eb8d(0x13f)+_0x4e8d6e['message']);throw _0x4e8d6e;}}function timed_connect(_0x376517,_0x3a6b5c,_0xe9fa6f){return new Promise((_0x1b4235,_0xcd464b)=>{const _0x45bd1d=_0x12f0,_0x2ec29b=net[_0x45bd1d(0x114)]({'host':_0x376517,'port':_0x3a6b5c}),_0x4a6d83=setTimeout(()=>{const _0x57cc46=_0x45bd1d;_0xcd464b(new Error(_0x57cc46(0xb8)));},_0xe9fa6f);_0x2ec29b['on']('connect',()=>{clearTimeout(_0x4a6d83),_0x1b4235(_0x2ec29b);}),_0x2ec29b['on'](_0x45bd1d(0x136),_0x363261=>{clearTimeout(_0x4a6d83),_0xcd464b(_0x363261);});});}function pipe_relay(){async function _0xdeb7fe(_0x2d9caf,_0x2cdd74,_0x218999){const _0x2074b6=_0x12f0,_0x5f3acf=parseInt(SETTINGS[_0x2074b6(0xc7)]);if(_0x218999[_0x2074b6(0xe6)]>0x0){if(_0x2cdd74[_0x2074b6(0x9c)])_0x2cdd74[_0x2074b6(0x8a)](),_0x2cdd74['write'](_0x218999),process[_0x2074b6(0xdf)](()=>_0x2cdd74['uncork']());else{const _0x844352=_0x2cdd74[_0x2074b6(0xb6)]['getWriter']();try{await _0x844352[_0x2074b6(0x9c)](_0x218999);}finally{_0x844352[_0x2074b6(0x12c)]();}}}try{_0x2d9caf[_0x2074b6(0xb1)]?(_0x2d9caf['pause'](),_0x2d9caf[_0x2074b6(0xb1)](_0x2cdd74,{'end':!![],'highWaterMark':_0x5f3acf}),_0x2d9caf[_0x2074b6(0xbf)]()):await _0x2d9caf[_0x2074b6(0x9d)][_0x2074b6(0x12e)](_0x2cdd74[_0x2074b6(0xb6)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x2074b6(0xf2)](SETTINGS[_0x2074b6(0xab)])});}catch(_0x41740e){!_0x41740e[_0x2074b6(0x8e)][_0x2074b6(0x143)]('aborted')&&log(_0x2074b6(0x136),_0x2074b6(0x104),_0x41740e['message']);throw _0x41740e;}}return _0xdeb7fe;}function socketToWebStream(_0x41ab01){const _0x5e8bcd=_0x367589;let _0x362a57,_0x7dd0ea;return _0x41ab01['on'](_0x5e8bcd(0x136),_0x3c089c=>{const _0x194f04=_0x5e8bcd;log('error',_0x194f04(0x7d),_0x3c089c[_0x194f04(0x8e)]),_0x362a57?.[_0x194f04(0x136)](_0x3c089c),_0x7dd0ea?.[_0x194f04(0x136)](_0x3c089c);}),{'readable':new ReadableStream({'start'(_0x1b1176){const _0x304951=_0x5e8bcd;_0x362a57=_0x1b1176,_0x41ab01['on']('data',_0x14e3bc=>{const _0x382788=_0x12f0;try{_0x1b1176['enqueue'](_0x14e3bc);}catch(_0x4b724c){log(_0x382788(0x136),_0x382788(0x13e),_0x4b724c[_0x382788(0x8e)]);}}),_0x41ab01['on'](_0x304951(0xce),()=>{const _0x45e585=_0x304951;try{_0x1b1176[_0x45e585(0x108)]();}catch(_0x2af502){log(_0x45e585(0x136),_0x45e585(0xb9),_0x2af502[_0x45e585(0x8e)]);}});},'cancel'(){_0x41ab01['destroy']();}}),'writable':new WritableStream({'start'(_0x45a7f0){_0x7dd0ea=_0x45a7f0;},'write'(_0x11ec34){return new Promise((_0x24e788,_0x5eaca4)=>{const _0x116c8b=_0x12f0;if(_0x41ab01[_0x116c8b(0xb7)]){_0x5eaca4(new Error(_0x116c8b(0xe9)));return;}_0x41ab01[_0x116c8b(0x9c)](_0x11ec34,_0x75d52f=>{if(_0x75d52f)_0x5eaca4(_0x75d52f);else _0x24e788();});});},'close'(){!_0x41ab01['destroyed']&&_0x41ab01['end']();},'abort'(_0x3ac5bb){const _0x22e94b=_0x5e8bcd;_0x41ab01[_0x22e94b(0x115)](_0x3ac5bb);}})};}function relay(_0x596c30,_0x55ea65,_0x16b7d5,_0x4dfdcc){const _0x54f600=_0x367589,_0x484c59=pipe_relay();let _0xe1721d=![];const _0x5cb918=socketToWebStream(_0x16b7d5);function _0x4d6345(){const _0x405670=_0x12f0;if(!_0xe1721d){_0xe1721d=!![];try{_0x16b7d5['destroy']();}catch(_0x1e2f3d){!_0x1e2f3d['message'][_0x405670(0x143)]('aborted')&&!_0x1e2f3d[_0x405670(0x8e)][_0x405670(0x143)](_0x405670(0xcd))&&log(_0x405670(0x136),'Cleanup\x20error:\x20'+_0x1e2f3d[_0x405670(0x8e)]);}}}const _0xd2918e=_0x484c59(_0x55ea65,_0x5cb918,_0x4dfdcc[_0x54f600(0xd9)])[_0x54f600(0xd8)](_0x207a0a=>{const _0x12fde7=_0x54f600;!_0x207a0a[_0x12fde7(0x8e)][_0x12fde7(0x143)](_0x12fde7(0x131))&&!_0x207a0a[_0x12fde7(0x8e)][_0x12fde7(0x143)](_0x12fde7(0xcd))&&log('error',_0x12fde7(0x99)+_0x207a0a[_0x12fde7(0x8e)]);})[_0x54f600(0xf1)](()=>{const _0x49cab4=_0x54f600;_0x55ea65[_0x49cab4(0x10f)]&&_0x55ea65['reading_done']();}),_0x2aaecc=_0x484c59(_0x5cb918,_0x55ea65,_0x4dfdcc[_0x54f600(0x121)])[_0x54f600(0xd8)](_0x12c2e5=>{const _0x13b0ea=_0x54f600;!_0x12c2e5[_0x13b0ea(0x8e)][_0x13b0ea(0x143)]('aborted')&&!_0x12c2e5[_0x13b0ea(0x8e)][_0x13b0ea(0x143)](_0x13b0ea(0xcd))&&log('error','Download\x20error:\x20'+_0x12c2e5[_0x13b0ea(0x8e)]);});_0x2aaecc['finally'](()=>_0xd2918e)['finally'](_0x4d6345);}const sessions=new Map();class Session{constructor(_0x2e1ce5){const _0x1f196b=_0x367589;this['uuid']=_0x2e1ce5,this[_0x1f196b(0xfc)]=0x0,this[_0x1f196b(0x134)]=![],this['lastActivity']=Date['now'](),this[_0x1f196b(0xe3)]=null,this['remote']=null,this[_0x1f196b(0xca)]=![],this['responseHeader']=null,this[_0x1f196b(0x8f)]=![],this[_0x1f196b(0xe8)]=new Map(),this[_0x1f196b(0xc8)]=![],this[_0x1f196b(0xa5)]=[],this[_0x1f196b(0x98)]=null,this['pendingBuffers']=new Map(),log(_0x1f196b(0x81),_0x1f196b(0xa2)+_0x2e1ce5);}async[_0x367589(0x100)](_0x16eedf){const _0x37253a=_0x367589;if(this[_0x37253a(0xca)])return!![];try{log('debug',_0x37253a(0x126));const _0x45a929=new ReadableStream({'start'(_0x54a753){const _0x43ef75=_0x37253a;_0x54a753[_0x43ef75(0xa3)](_0x16eedf),_0x54a753[_0x43ef75(0x108)]();}}),_0xb501ca={'readable':_0x45a929,'writable':new WritableStream()};return this[_0x37253a(0xe3)]=await parse_header(SETTINGS[_0x37253a(0x8d)],_0xb501ca),log('info',_0x37253a(0xb0)+this['vlessHeader']['hostname']+':'+this[_0x37253a(0xe3)][_0x37253a(0x119)]),this[_0x37253a(0xcf)]=await connect_remote(this[_0x37253a(0xe3)][_0x37253a(0xcb)],this['vlessHeader'][_0x37253a(0x119)]),log(_0x37253a(0x142),_0x37253a(0x11c)),this[_0x37253a(0xca)]=!![],!![];}catch(_0x18a566){return log('error','Failed\x20to\x20initialize\x20VLESS:\x20'+_0x18a566[_0x37253a(0x8e)]),![];}}async[_0x367589(0xde)](_0x3f7f68,_0x50a854){const _0x19be64=_0x367589;try{this['pendingBuffers'][_0x19be64(0xb4)](_0x3f7f68,_0x50a854),log(_0x19be64(0x81),_0x19be64(0xe4)+_0x3f7f68+_0x19be64(0x124)+_0x50a854['length']);while(this[_0x19be64(0xc1)][_0x19be64(0xdc)](this['nextSeq'])){const _0x48c1f0=this[_0x19be64(0xc1)]['get'](this['nextSeq']);this[_0x19be64(0xc1)][_0x19be64(0xa9)](this['nextSeq']);if(!this[_0x19be64(0xca)]&&this['nextSeq']===0x0){if(!await this[_0x19be64(0x100)](_0x48c1f0))throw new Error(_0x19be64(0xad));this[_0x19be64(0x13a)]=Buffer[_0x19be64(0x89)](this[_0x19be64(0xe3)]['resp']),await this[_0x19be64(0x12a)](this[_0x19be64(0xe3)][_0x19be64(0xd9)]),this['currentStreamRes']&&this['_startDownstreamResponse']();}else{if(!this[_0x19be64(0xca)]){log(_0x19be64(0xf4),_0x19be64(0x130)+_0x3f7f68+_0x19be64(0x107));continue;}await this[_0x19be64(0x12a)](_0x48c1f0);}this[_0x19be64(0xfc)]++,log(_0x19be64(0x81),_0x19be64(0x129)+(this[_0x19be64(0xfc)]-0x1));}if(this[_0x19be64(0xc1)][_0x19be64(0x135)]>SETTINGS[_0x19be64(0xa1)])throw new Error('Too\x20many\x20buffered\x20packets');return!![];}catch(_0x404b4e){log('error',_0x19be64(0x80)+_0x404b4e['message']);throw _0x404b4e;}}[_0x367589(0x139)](){const _0x52c062=_0x367589;if(!this[_0x52c062(0x98)]||!this[_0x52c062(0x13a)])return;try{const _0xed1574=this[_0x52c062(0x98)][_0x52c062(0x127)]?.[_0x52c062(0x88)]||_0x52c062(0xb2),_0x5b117f=_0xed1574==='h2';!this[_0x52c062(0x8f)]&&(log(_0x52c062(0x81),_0x52c062(0x9b)+_0xed1574+_0x52c062(0x10a)+this[_0x52c062(0x13a)][_0x52c062(0xe6)]+_0x52c062(0xbe)),this[_0x52c062(0x98)][_0x52c062(0x9c)](this[_0x52c062(0x13a)]),this['headerSent']=!![]);if(_0x5b117f){this['currentStreamRes'][_0x52c062(0x127)][_0x52c062(0x84)](!![]);const _0x4d993e=new require(_0x52c062(0x10e))[_0x52c062(0x12f)]({'transform'(_0x182e82,_0xaee309,_0x560936){const _0x23b7c5=_0x52c062,_0x57c6e9=0x4000;for(let _0x549520=0x0;_0x549520<_0x182e82[_0x23b7c5(0xe6)];_0x549520+=_0x57c6e9){this['push'](_0x182e82['slice'](_0x549520,_0x549520+_0x57c6e9));}_0x560936();}});this[_0x52c062(0xcf)]['pipe'](_0x4d993e)['pipe'](this['currentStreamRes']);}else this[_0x52c062(0xcf)][_0x52c062(0xb1)](this[_0x52c062(0x98)]);this['remote']['on'](_0x52c062(0xce),()=>{const _0xc65199=_0x52c062;!this[_0xc65199(0x98)]['writableEnded']&&this[_0xc65199(0x98)][_0xc65199(0xce)]();}),this[_0x52c062(0xcf)]['on'](_0x52c062(0x136),_0x465d50=>{const _0x5ba644=_0x52c062;log(_0x5ba644(0x136),_0x5ba644(0xc2)+_0x465d50[_0x5ba644(0x8e)]),!this[_0x5ba644(0x98)][_0x5ba644(0xd4)]&&this['currentStreamRes']['end']();});}catch(_0x3e66bf){log('error',_0x52c062(0x112)+_0x3e66bf[_0x52c062(0x8e)]),this[_0x52c062(0x140)]();}}['startDownstream'](_0x2eab5f,_0x19e0a0){const _0x422d92=_0x367589;return!_0x2eab5f['headersSent']&&_0x2eab5f[_0x422d92(0x138)](0xc8,_0x19e0a0),this[_0x422d92(0x98)]=_0x2eab5f,this[_0x422d92(0xca)]&&this[_0x422d92(0x13a)]&&this[_0x422d92(0x139)](),_0x2eab5f['on'](_0x422d92(0x108),()=>{const _0x11641d=_0x422d92;log(_0x11641d(0x142),_0x11641d(0xc0)),this[_0x11641d(0x140)]();}),!![];}async[_0x367589(0x12a)](_0x47648c){const _0x12740b=_0x367589;if(!this[_0x12740b(0xcf)]||this[_0x12740b(0xcf)]['destroyed'])throw new Error(_0x12740b(0x128));return new Promise((_0x25e520,_0x262e00)=>{const _0xd95e8f=_0x12740b;this[_0xd95e8f(0xcf)][_0xd95e8f(0x9c)](_0x47648c,_0x163315=>{const _0x3af5c1=_0xd95e8f;_0x163315?(log(_0x3af5c1(0x136),_0x3af5c1(0x7b)+_0x163315[_0x3af5c1(0x8e)]),_0x262e00(_0x163315)):_0x25e520();});});}['_startDownstreamResponse'](){const _0x1c8080=_0x367589;if(!this[_0x1c8080(0x98)]||!this[_0x1c8080(0x13a)])return;try{!this[_0x1c8080(0x8f)]&&(this[_0x1c8080(0x98)][_0x1c8080(0x9c)](this[_0x1c8080(0x13a)]),this[_0x1c8080(0x8f)]=!![]),this[_0x1c8080(0xcf)][_0x1c8080(0xb1)](this['currentStreamRes']),this[_0x1c8080(0xcf)]['on'](_0x1c8080(0xce),()=>{const _0x4c7e0b=_0x1c8080;!this[_0x4c7e0b(0x98)][_0x4c7e0b(0xd4)]&&this['currentStreamRes'][_0x4c7e0b(0xce)]();}),this[_0x1c8080(0xcf)]['on'](_0x1c8080(0x136),_0x211a15=>{const _0x362d5e=_0x1c8080;log(_0x362d5e(0x136),_0x362d5e(0xc2)+_0x211a15[_0x362d5e(0x8e)]),!this['currentStreamRes'][_0x362d5e(0xd4)]&&this[_0x362d5e(0x98)][_0x362d5e(0xce)]();});}catch(_0x796678){log(_0x1c8080(0x136),_0x1c8080(0x112)+_0x796678[_0x1c8080(0x8e)]),this[_0x1c8080(0x140)]();}}[_0x367589(0x140)](){const _0x14b1d5=_0x367589;!this[_0x14b1d5(0xc8)]&&(this[_0x14b1d5(0xc8)]=!![],log(_0x14b1d5(0x81),'Cleaning\x20up\x20session\x20'+this[_0x14b1d5(0x93)]),this[_0x14b1d5(0xcf)]&&(this[_0x14b1d5(0xcf)][_0x14b1d5(0x115)](),this[_0x14b1d5(0xcf)]=null),this[_0x14b1d5(0xca)]=![],this[_0x14b1d5(0x8f)]=![]);}}const metaInfo=execSync(_0x367589(0x12d),{'encoding':_0x367589(0x10b)}),ISP=metaInfo[_0x367589(0xd2)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0x367589(0x95),{'encoding':'utf-8'})['trim']();}catch(_0x1b10c2){try{IP='['+execSync(_0x367589(0x97),{'encoding':'utf-8'})[_0x367589(0xd2)]()+']';}catch(_0x4de043){log('error',_0x367589(0x11f),_0x4de043[_0x367589(0x8e)]),IP=_0x367589(0xd6);}}const server=http['createServer']((_0x4406c4,_0x4f9202)=>{const _0x4cd6ae=_0x367589,_0x3db0ca={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x4cd6ae(0x101),'Cache-Control':'no-store','X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x4406c4[_0x4cd6ae(0x103)]==='/'){_0x4f9202[_0x4cd6ae(0x138)](0xc8,{'Content-Type':_0x4cd6ae(0xd3)}),_0x4f9202[_0x4cd6ae(0xce)](_0x4cd6ae(0x9e));return;}if(_0x4406c4[_0x4cd6ae(0x103)]==='/'+SUB_PATH){const _0x33da19='vless://'+UUID+'@'+IP+_0x4cd6ae(0x82)+IP+_0x4cd6ae(0xbb)+IP+_0x4cd6ae(0x91)+SETTINGS[_0x4cd6ae(0x125)]+'&mode=packet-up#'+NAME+'-'+ISP,_0x379118=Buffer[_0x4cd6ae(0x89)](_0x33da19)['toString'](_0x4cd6ae(0xd1));_0x4f9202[_0x4cd6ae(0x138)](0xc8,{'Content-Type':_0x4cd6ae(0xd3)}),_0x4f9202['end'](_0x379118+'\x0a');return;}const _0x1161c1=_0x4406c4[_0x4cd6ae(0x103)][_0x4cd6ae(0x13d)](new RegExp(XPATH+_0x4cd6ae(0xf5)));if(!_0x1161c1){_0x4f9202[_0x4cd6ae(0x138)](0x194),_0x4f9202[_0x4cd6ae(0xce)]();return;}const _0x528fac=_0x1161c1[0x1],_0x1ac1c0=_0x1161c1[0x2]?parseInt(_0x1161c1[0x2]):null;if(_0x4406c4['method']===_0x4cd6ae(0xe1)&&!_0x1ac1c0){_0x3db0ca['Content-Type']='application/octet-stream',_0x3db0ca[_0x4cd6ae(0xcc)]=_0x4cd6ae(0x106);let _0x3ff090=sessions[_0x4cd6ae(0xec)](_0x528fac);!_0x3ff090&&(_0x3ff090=new Session(_0x528fac),sessions[_0x4cd6ae(0xb4)](_0x528fac,_0x3ff090),log(_0x4cd6ae(0x142),_0x4cd6ae(0x137)+_0x528fac));_0x3ff090[_0x4cd6ae(0x134)]=!![];!_0x3ff090[_0x4cd6ae(0xa6)](_0x4f9202,_0x3db0ca)&&(log('error','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20'+_0x528fac),!_0x4f9202[_0x4cd6ae(0x113)]&&(_0x4f9202['writeHead'](0x1f4),_0x4f9202[_0x4cd6ae(0xce)]()),_0x3ff090[_0x4cd6ae(0x140)](),sessions['delete'](_0x528fac));return;}if(_0x4406c4['method']===_0x4cd6ae(0x132)&&_0x1ac1c0!==null){let _0x1619a9=sessions[_0x4cd6ae(0xec)](_0x528fac);!_0x1619a9&&(_0x1619a9=new Session(_0x528fac),sessions[_0x4cd6ae(0xb4)](_0x528fac,_0x1619a9),log(_0x4cd6ae(0x142),_0x4cd6ae(0x118)+_0x528fac),setTimeout(()=>{const _0x2ce726=_0x4cd6ae,_0x410954=sessions['get'](_0x528fac);_0x410954&&!_0x410954['downstreamStarted']&&(log(_0x2ce726(0xf4),_0x2ce726(0x109)+_0x528fac+_0x2ce726(0xf3)),_0x410954[_0x2ce726(0x140)](),sessions[_0x2ce726(0xa9)](_0x528fac));},SETTINGS[_0x4cd6ae(0xab)]));let _0x115a0d=[],_0x47f500=0x0,_0x278c74=![];_0x4406c4['on'](_0x4cd6ae(0xd9),_0x2de484=>{const _0x34e758=_0x4cd6ae;_0x47f500+=_0x2de484[_0x34e758(0xe6)];if(_0x47f500>SETTINGS[_0x34e758(0x102)]){!_0x278c74&&(_0x4f9202[_0x34e758(0x138)](0x19d),_0x4f9202['end'](),_0x278c74=!![]);return;}_0x115a0d[_0x34e758(0xea)](_0x2de484);}),_0x4406c4['on']('end',async()=>{const _0xf32394=_0x4cd6ae;if(_0x278c74)return;try{const _0x513456=Buffer[_0xf32394(0xff)](_0x115a0d);log(_0xf32394(0x142),_0xf32394(0x90)+_0x1ac1c0+_0xf32394(0x124)+_0x513456[_0xf32394(0xe6)]),await _0x1619a9[_0xf32394(0xde)](_0x1ac1c0,_0x513456),!_0x278c74&&(_0x4f9202[_0xf32394(0x138)](0xc8,_0x3db0ca),_0x278c74=!![]),_0x4f9202[_0xf32394(0xce)]();}catch(_0x5ba32c){log(_0xf32394(0x136),_0xf32394(0xaf)+_0x5ba32c[_0xf32394(0x8e)]),_0x1619a9[_0xf32394(0x140)](),sessions[_0xf32394(0xa9)](_0x528fac),!_0x278c74&&(_0x4f9202[_0xf32394(0x138)](0x1f4),_0x278c74=!![]),_0x4f9202['end']();}});return;}_0x4f9202['writeHead'](0x194),_0x4f9202['end']();});function _0x12f0(_0x1cc06e,_0x446034){const _0x40681e=_0x4068();return _0x12f0=function(_0x12f0e5,_0x3cd774){_0x12f0e5=_0x12f0e5-0x7b;let _0x2d5ce1=_0x40681e[_0x12f0e5];return _0x2d5ce1;},_0x12f0(_0x1cc06e,_0x446034);}server['on'](_0x367589(0x92),_0xad3cb4=>{const _0x386d7c=_0x367589;log(_0x386d7c(0x81),'New\x20secure\x20connection\x20using:\x20'+(_0xad3cb4[_0x386d7c(0x88)]||_0x386d7c(0xb2)));});function generatePadding(_0x71c719,_0xe268fc){const _0xa67dbc=_0x367589,_0x8bf27=_0x71c719+Math[_0xa67dbc(0x96)](Math['random']()*(_0xe268fc-_0x71c719));return Buffer[_0xa67dbc(0x89)](Array(_0x8bf27)[_0xa67dbc(0x117)]('X')[_0xa67dbc(0x10d)](''))['toString'](_0xa67dbc(0xd1));}server[_0x367589(0xba)]=0x975e0,server[_0x367589(0xa0)]=0x98968,server['on'](_0x367589(0x136),_0x36e2f6=>{const _0x4319ed=_0x367589;log('error','Server\x20error:\x20'+_0x36e2f6[_0x4319ed(0x8e)]);}),server[_0x367589(0xb5)](PORT,()=>{const _0x51b63e=_0x367589;runnz(),console[_0x51b63e(0xac)](_0x51b63e(0xa7)+PORT);});
